var Verify={login:function(r){if(r=decodeURIComponent(r),Validate.goValidate({target:$("#loginTip"),data:[{target:$("#nameOrEmail"),type:"string",max:256,msg:Label.loginNameErrorLabel}]})){var e={nameOrEmail:$("#nameOrEmail").val().replace(/(^\s*)|(\s*$)/g,""),userPassword:calcMD5($("#loginPassword").val()),rememberLogin:$("#rememberLogin").prop("checked"),captcha:$("#captchaLogin").val().replace(/(^\s*)|(\s*$)/g,"")};$.ajax({url:Label.servePath+"/login",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,a){0===e.code?window.location.href=r:($("#loginTip").addClass("error").html("<ul><li>"+e.msg+"</li></ul>"),e.needCaptcha&&""!==e.needCaptcha&&($("#captchaImg").parent().show(),$("#captchaImg").attr("src",Label.servePath+"/captcha/login?needCaptcha="+e.needCaptcha+"&t="+Math.random()).click(function(){$(this).attr("src",Label.servePath+"/captcha/login?needCaptcha="+e.needCaptcha+"&t="+Math.random())})))}})}},register:function(){if(Validate.goValidate({target:$("#registerTip"),data:[{target:$("#registerUserName"),msg:Label.invalidUserNameLabel,type:"string",max:20},{target:$("#registerUserEmail"),msg:Label.invalidEmailLabel,type:"email"}]})){var e={userName:$("#registerUserName").val().replace(/(^\s*)|(\s*$)/g,""),userEmail:$("#registerUserEmail").val().replace(/(^\s*)|(\s*$)/g,""),invitecode:$("#registerInviteCode").val().replace(/(^\s*)|(\s*$)/g,""),captcha:$("#registerCaptcha").val(),referral:sessionStorage.r||""};$("#registerBtn").attr("disabled","disabled"),$.ajax({url:Label.servePath+"/register",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,a){0===e.code?($("#registerTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>"),$("#registerBtn").attr("disabled","disabled")):($("#registerTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#registerCaptchaImg").attr("src",Label.servePath+"/captcha?code="+Math.random()),$("#registerCaptcha").val(""),$("#registerBtn").removeAttr("disabled"))}})}},register2:function(){if(Validate.goValidate({target:$("#registerTip2"),data:[{target:$("#registerUserPassword2"),msg:Label.invalidPasswordLabel,type:"password",max:20},{target:$("#registerConfirmPassword2"),original:$("#registerUserPassword2"),msg:Label.confirmPwdErrorLabel,type:"confirmPassword"}]})){var e={userAppRole:$("input[name=userAppRole]:checked").val(),userPassword:calcMD5($("#registerUserPassword2").val()),referral:$("#referral2").val(),userId:$("#userId2").val()};$.ajax({url:Label.servePath+"/register2",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,a){0===e.code?window.location.href=Label.servePath:$("#registerTip2").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}})}},forgetPwd:function(){if(Validate.goValidate({target:$("#fpwdTip"),data:[{target:$("#fpwdEmail"),msg:Label.invalidEmailLabel,type:"email"},{target:$("#fpwdSecurityCode"),msg:Label.captchaErrorLabel,type:"string",max:4}]})){var e={userEmail:$("#fpwdEmail").val().replace(/(^\s*)|(\s*$)/g,""),captcha:$("#fpwdSecurityCode").val()};$.ajax({url:Label.servePath+"/forget-pwd",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,a){0===e.code?$("#fpwdTip").addClass("succ").removeClass("error").html("<ul><li>"+e.msg+"</li></ul>"):($("#fpwdTip").removeClass("tip-succ"),$("#fpwdTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>"),$("#fpwdCaptcha").attr("src",Label.servePath+"/captcha?code="+Math.random()),$("#fpwdSecurityCode").val(""))}})}},resetPwd:function(){if(Validate.goValidate({target:$("#rpwdTip"),data:[{target:$("#rpwdUserPassword"),msg:Label.invalidPasswordLabel,type:"password",max:20},{target:$("#rpwdConfirmPassword"),original:$("#rpwdUserPassword"),msg:Label.confirmPwdErrorLabel,type:"confirmPassword"}]})){var e={userPassword:calcMD5($("#rpwdUserPassword").val()),userId:$("#rpwdUserId").val(),code:$("#code").val()};$.ajax({url:Label.servePath+"/reset-pwd",type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,a){0===e.code?window.location.href=Label.servePath:$("#rpwdTip").addClass("error").removeClass("succ").html("<ul><li>"+e.msg+"</li></ul>")}})}},init:function(){$("#registerCaptcha, #registerInviteCode").keyup(function(e){13===e.keyCode&&Verify.register()}),$("#fpwdSecurityCode").keyup(function(e){13===e.keyCode&&Verify.forgetPwd()}),$("#loginPassword, #captchaLogin").keyup(function(e){13===e.keyCode&&$("#loginTip").next().click()}),$("#rpwdConfirmPassword").keyup(function(e){13===e.keyCode&&Verify.resetPwd()})},initGuide:function(e,a){if(0===e)return window.location.href=Label.servePath,!1;function r(){switch(6!==e&&($(".intro dt").removeClass("current"),$(".guide-tab > div").hide()),e<6&&0<e&&$.ajax({url:Label.servePath+"/guide/next",type:"POST",cache:!1,data:JSON.stringify({userGuideStep:e}),success:function(e,a){0!==e.code&&Util.alert(e.msg)}}),e){case 1:$(".guide-tab > div:eq(0)").show(),$(".step-btn .red").hide(),$(".intro dt:eq(0)").addClass("current");break;case 2:$(".guide-tab > div:eq(1)").show(),$(".step-btn .red").show(),$(".intro dt:eq(1)").addClass("current"),$(".step-btn .green, .step-btn .red").prop("disabled",!0),$(".tag-desc").isotope({sortBy:t}),t="random"===t?"original-order":"random",$(".tag-desc").on("arrangeComplete",function(){$(".step-btn .green, .step-btn .red").prop("disabled",!1)}),$(".tag-desc li").length<2&&$(".step-btn .green, .step-btn .red").prop("disabled",!1);break;case 3:$(".guide-tab > div:eq(2)").show(),$(".intro dt:eq(2)").addClass("current"),$(".step-btn .red").show();break;case 4:$(".guide-tab > div:eq(3)").show(),$(".intro dt:eq(3)").addClass("current"),$(".step-btn .red").show(),$(".step-btn .green").text(Label.nextStepLabel),$(".intro > div").hide(),$(".intro > dl").show();break;case 5:$(".guide-tab > div:eq(4)").show(),$(".step-btn .red").show(),$(".step-btn .green").text(Label.finshLabel),$(".intro > div").show(),$(".intro > dl").hide();break;case 6:window.location.href=Label.servePath}}var t="random";$(".step-btn .green").click(function(){if(5<e)return!1;e++,r()}),$(".step-btn .red").click(function(){e--,r()}),$(".tag-desc li").click(function(){var e=$(this);e.hasClass("current")?(Util.unfollow(window,e.data("id"),"tag"),e.removeClass("current")):(Util.follow(window,e.data("id"),"tag"),e.addClass("current"))}),r(),$(".tag-desc").isotope({transitionDuration:"1.5s",filter:"li",layoutMode:"fitRows"});var s=parseInt(Math.random()*a);$(".tag-desc li:eq("+s+")").addClass("current"),Util.follow(window,$(".tag-desc li:eq("+s+")").data("id"),"tag")}};