var Comment={editor:void 0,exchangeCmtSort:function(e){e=0===e?1:0,window.location.href=window.location.pathname+"?m="+e},_bgFade:function(e){return $(window).scrollTop(e.offset().top),"comments"!==e.attr("id")&&(e.css({"background-color":"#9bbee0"}),setTimeout(function(){e.css({"background-color":"#FFF",transition:"all 3s cubic-bezier(0.56, -0.36, 0.58, 1)"})},100),void setTimeout(function(){e.removeAttr("style")},3100))},goComment:function(e){return 0===$(e.substr(e.length-14,14)).length?(window.location=e,!1):($("#comments .list > ul > li").removeAttr("style"),void Comment._bgFade($(e.substr(e.length-14,14))))},_setCmtVia:function(){$(".cmt-via").each(function(){var e=$(this).data("ua"),t=Util.getDeviceByUa(e);""!==t&&$(this).html("via "+t)})},_initEditorPanel:function(){$(".article-actions .icon-reply-btn").click(function(){return Label.isLoggedIn?($(".footer").css("margin-bottom",$(".editor-panel").outerHeight()+"px"),$("#replyUseName").html('<a href="javascript:void(0)" onclick="Util.goTop();Comment._bgFade($(\'.article-module\'))" class="ft-a-title"><span class="icon-reply-to"></span>'+$(".article-title").text()+"</a>").removeData(),"0px"!==$(".editor-panel").css("bottom")&&$(".editor-panel").hide().css("bottom",0),void $(".editor-panel").slideDown(function(){Comment.editor.focus()})):(Util.needLogin(),!1)}),$(".editor-panel .editor-hide").click(function(){$(".editor-panel").slideUp(),$(".footer").removeAttr("style")})},_initHotKey:function(){return!(!Label.userKeyboardShortcutsStatus||"1"===Label.userKeyboardShortcutsStatus)&&void $(document).bind("keyup","x",function(){return Util.prevKey="x",setTimeout(function(){Util.prevKey=void 0},1e3),!1}).bind("keyup","v",function(){return Util.prevKey="v",setTimeout(function(){Util.prevKey=void 0},1e3),!1}).bind("keydown","r",function(e){return Util.prevKey?"v"===Util.prevKey?$(".article-actions .icon-points").parent().click():1===$("#comments .list > ul > li.focus").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .icon-reply").parent().click():$(".article-actions .icon-reply-btn").click(),!1}).bind("keyup","h",function(){return 1===$("#comments .list > ul > li.focus").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .icon-heart").parent().click(),!1}).bind("keyup","t",function(){return 1===$("#comments .list > ul > li.focus").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .icon-thumbs-up").parent().click(),!1}).bind("keyup","d",function(){return 1===$("#comments .list > ul > li.focus").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .icon-thumbs-down").parent().click(),!1}).bind("keyup","c",function(){return 1===$("#comments .list > ul > li.focus .comment-info .fn-pointer.ft-fade").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .comment-info .fn-pointer.ft-fade").click(),!1}).bind("keyup","m",function(){return 1===$("#comments .list > ul > li.focus .comment-action > .ft-fade > .fn-pointer").length&&"x"===Util.prevKey&&$("#comments .list > ul > li.focus .comment-action > .ft-fade > .fn-pointer").click(),!1}).bind("keyup","a",function(){return"x"===Util.prevKey&&1===$("#comments .list > ul > li.focus .icon-setting").parent().length&&(window.location=$("#comments .list > ul > li.focus .icon-setting").parent().attr("href")),!1}).bind("keyup","m",function(){return"v"===Util.prevKey&&Article.toggleToc(),!1}).bind("keyup","h",function(){return"v"===Util.prevKey&&$("#thankArticle").click(),!1}).bind("keyup","t",function(){return"v"===Util.prevKey&&$(".article-actions .icon-thumbs-up").parent().click(),!1}).bind("keyup","d",function(){return"v"===Util.prevKey&&$(".article-actions .icon-thumbs-down").parent().click(),!1}).bind("keyup","i",function(){return"v"===Util.prevKey&&$(".article-actions .icon-view").parent().click(),!1}).bind("keyup","c",function(){return"v"===Util.prevKey&&$(".article-actions .icon-star").parent().click(),!1}).bind("keyup","l",function(){return"v"===Util.prevKey&&$(".article-actions .icon-history").parent().click(),!1}).bind("keyup","e",function(){return"v"===Util.prevKey&&1===$(".article-actions .icon-edit").parent().length&&(window.location=$(".article-actions .icon-edit").parent().attr("href")),!1}).bind("keyup","s",function(){return"v"===Util.prevKey&&1===$(".article-actions .icon-chevron-up").length&&Article.stick(Label.articleOId),!1}).bind("keyup","a",function(){return"v"===Util.prevKey&&1===$(".article-actions .icon-setting").parent().length&&(window.location=$(".article-actions .icon-setting").parent().attr("href")),!1}).bind("keyup","p",function(){return"v"===Util.prevKey&&1===$(".article-module-bottom a[rel=prev]").length&&(window.location=$(".article-module-bottom a[rel=prev]").attr("href")),!1}).bind("keyup","n",function(){return"v"===Util.prevKey&&1===$(".article-module-bottom a[rel=next]").length&&(window.location=$(".article-module-bottom a[rel=next]").attr("href")),!1})},init:function(){if($("#comments").on("dblclick","img",function(){window.open($(this).attr("src"))}),1===$(window.location.hash).length&&(isNaN(parseInt(window.location.hash.substr(1)))||Comment._bgFade($(window.location.hash))),this._setCmtVia(),this._initEditorPanel(),$.ua.set(navigator.userAgent),this._initHotKey(),!Label.isLoggedIn)return!1;if("mobile"!==$.ua.device.type||"Apple"!==$.ua.device.vendor&&"Nokia"!==$.ua.device.vendor){Util.initCodeMirror();var e=new Editor({element:document.getElementById("commentContent"),dragDrop:!1,lineWrapping:!0,htmlURL:Label.servePath+"/markdown",toolbar:[{name:"bold"},{name:"italic"},"|",{name:"quote"},{name:"unordered-list"},{name:"ordered-list"},"|",{name:"link"},{name:"image",html:'<form id="fileUpload" method="POST" enctype="multipart/form-data"><label class="icon-upload"><input type="file"/></label></form>'},"|",{name:"redo"},{name:"undo"},"|",{name:"view"},{name:"fullscreen"}],extraKeys:{"Alt-/":"autocompleteUserName","Cmd-/":"autocompleteEmoji","Ctrl-/":"autocompleteEmoji","Alt-S":"startAudioRecord","Alt-R":"endAudioRecord",Esc:function(){$(".editor-hide").click()}},status:!1});e.render(),e.codemirror.for="comment",Comment.editor=e.codemirror}else $("#commentContent").before('<form id="fileUpload" method="POST" enctype="multipart/form-data"><label class="btn">'+Label.uploadLabel+'<input type="file"/></label></form>').css("margin",0),Comment.editor=Util.initTextarea("commentContent",function(e){window.localStorage&&(window.localStorage[Label.articleOId]=JSON.stringify({commentContent:e.$it.val()}))});if(window.localStorage&&window.localStorage[Label.articleOId]){var t=null;try{t=JSON.parse(window.localStorage[Label.articleOId])}catch(e){var i={commentContent:""};window.localStorage[Label.articleOId]=JSON.stringify(i),t=JSON.parse(window.localStorage[Label.articleOId])}""!==t.commentContent.replace(/(^\s*)|(\s*$)/g,"")&&Comment.editor.setValue(t.commentContent)}return this._initMathJax(),("mobile"!==$.ua.device.type||"Apple"!==$.ua.device.vendor&&"Nokia"!==$.ua.device.vendor)&&(Comment.editor.on("changes",function(e){$("#addCommentTip").removeClass("error succ").html(""),window.localStorage&&(window.localStorage[Label.articleOId]=JSON.stringify({commentContent:e.getValue()}));var t=e.getCursor(),i=e.getTokenAt(t);return 0===i.string.indexOf("@")?(e.showHint({hint:CodeMirror.hint.userName,completeSingle:!1}),CodeMirror.Pass):0!==$(".article-comment-content .editor-preview-active").length&&void $.ajax({url:Label.servePath+"/markdown",type:"POST",cache:!1,data:{markdownText:e.getValue()},success:function(e,t){$(".article-comment-content .editor-preview-active").html(e.html),hljs.initHighlighting.called=!1,hljs.initHighlighting()}})}),Comment.editor.on("keypress",function(e,t){if(t.ctrlKey&&10===t.charCode)return Comment.add(Label.articleOId,Label.csrfToken),!1}),void Comment.editor.on("keydown",function(e,t){if($.ua.set(navigator.userAgent),$.ua.os.name.indexOf("Mac OS")>-1&&t.metaKey&&13===t.keyCode)return Comment.add(Label.articleOId,Label.csrfToken),!1;if(8===t.keyCode){var i=e.getCursor(),n=e.getTokenAt(i),o=CodeMirror.Pos(i.line,i.ch);n=e.getTokenAt(o),/^:\S+:$/.test(n.string)&&e.replaceRange("",CodeMirror.Pos(i.line,n.start),CodeMirror.Pos(i.line,n.end-1))}}))},_initMathJax:function(){var e=!1;$(".content-reset").each(function(){$(this).find("p").each(function(){if($(this).text().indexOf("$/")>-1||$(this).text().indexOf("$$")>-1)return e=!0,!1})}),e&&$.ajax({method:"GET",url:"https://cdn.staticfile.org/MathJax/MathJax-2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&_=1473258780393",dataType:"script"}).done(function(){MathJax.Hub.Config({tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0,skipTags:["pre","code"]}}),MathJax.Hub.Queue(function(){var e,t=MathJax.Hub.getAllJax();for(e=0;e<t.length;e+=1)1===$(t[e].SourceElement().parentNode).closest(".content-reset")&&(t[e].SourceElement().parentNode.className+="has-jax")})})},thank:function(e,t,i,n,o){if(!Label.isLoggedIn)return Util.needLogin(),!1;if(0===n&&!confirm(i))return!1;var r={commentId:e};$.ajax({url:Label.servePath+"/comment/thank",type:"POST",headers:{csrfToken:t},cache:!1,data:JSON.stringify(r),error:function(e,t,i){alert(i)},success:function(e,t){if(e.sc){$(o).removeAttr("onclick");var i=$("<i class='icon-heart ft-red'></i>"),n=$(o).offset().top,r=$(o).offset().left;i.css({"z-index":9999,top:n,left:r,position:"absolute","font-size":16,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),$("body").append(i),i.animate({left:r-150,top:n-60,opacity:0},1e3,function(){var e=parseInt($(o).text());$(o).html('<span class="icon-heart"></span> '+(e+1)).addClass("ft-red"),i.remove()})}else alert(e.msg)}})},showReply:function(e,t,i){var n=$(t).closest("li").find("."+i);if("comment-get-comment"===i){if(0!==n.find("li").length)return n.toggle(),!1}else if(0===$(t).find(".icon-chevron-down").length)return $(t).find(".icon-chevron-up").removeClass("icon-chevron-up").addClass("icon-chevron-down"),n.html(""),!1;if("0.3"===$(t).css("opacity"))return!1;var o="/comment/replies";"comment-get-comment"===i&&(o="/comment/original"),$.ajax({url:Label.servePath+o,type:"POST",data:JSON.stringify({commentId:e,userCommentViewMode:Label.userCommentViewMode}),beforeSend:function(){$(t).css("opacity","0.3")},success:function(e,i){if(!e.sc)return alert(e.msg),!1;var o=e.commentReplies,r="";o instanceof Array||(o=[o]);for(var a=0;a<o.length;a++){var s=o[a];r+='<li><div class="fn-flex">',"someone"!==s.commentAuthorName&&(r+='<a rel="nofollow" href="/member/'+s.commentAuthorName+'">'),r+='<div class="avatar tooltipped tooltipped-se" aria-label="'+s.commentAuthorName+'" style="background-image:url('+s.commentAuthorThumbnailURL+')"></div>',"someone"!==s.commentAuthorName&&(r+="</a>"),r+='<div class="fn-flex-1"><div class="comment-info ft-smaller">',"someone"!==s.commentAuthorName&&(r+='<a class="ft-gray" rel="nofollow" href="/member/'+s.commentAuthorName+'">'),r+=s.commentAuthorName,"someone"!==s.commentAuthorName&&(r+="</a>"),r+='<span class="ft-fade"> â€¢ '+s.timeAgo,s.rewardedCnt>0&&(r+='<span aria-label="'+(s.rewarded?Label.thankedLabel:Label.thankLabel+" "+s.rewardedCnt)+'" class="tooltipped tooltipped-n '+(s.rewarded?"ft-red":"ft-fade")+'"> <span class="icon-heart"></span>'+s.rewardedCnt+"</span> "),r+=" "+Util.getDeviceByUa(s.commentUA)+"</span>",r+='<a class="tooltipped tooltipped-nw ft-a-title fn-right" aria-label="'+Label.referenceLabel+'" href="javascript:Comment.goComment(\''+Label.servePath+"/article/"+Label.articleOId+"?p="+s.paginationCurrentPageNum+"&m="+Label.userCommentViewMode+"#"+s.oId+'\')"><span class="icon-quote"></span></a></div><div class="content-reset comment">'+s.commentContent+"</div></div></div></li>"}n.html("<ul>"+r+"</ul>"),Article.parseLanguage(),$(t).find(".icon-chevron-down").removeClass("icon-chevron-down").addClass("icon-chevron-up")},error:function(e){alert(e.statusText)},complete:function(){$(t).css("opacity","1")}})},add:function(e,t){if(!Validate.goValidate({target:$("#addCommentTip"),data:[{target:Comment.editor,type:"editor",max:2e3,msg:Label.commentErrorLabel}]}))return!1;var i={articleId:e,commentAnonymous:$("#commentAnonymous").prop("checked"),commentContent:Comment.editor.getValue(),userCommentViewMode:Label.userCommentViewMode};$("#replyUseName").data("commentOriginalCommentId")&&(i.commentOriginalCommentId=$("#replyUseName").data("commentOriginalCommentId")),$.ajax({url:Label.servePath+"/comment",type:"POST",headers:{csrfToken:t},cache:!1,data:JSON.stringify(i),beforeSend:function(){$(".form button.red").attr("disabled","disabled").css("opacity","0.3"),Comment.editor.setOption("readOnly","nocursor")},success:function(e,t){if($(".form button.red").removeAttr("disabled").css("opacity","1"),e.sc){if(Comment.editor.setValue(""),$(".editor-preview").html(""),$(".icon-view").hasClass("active")&&$(".icon-view").click(),$(".editor-hide").click(),$("#replyUseName").text("").removeData(),window.localStorage){var i={commentContent:""};window.localStorage[Label.articleOId]=JSON.stringify(i)}1===Label.userCommentViewMode?window.location.hash="#comments":window.location.hash="#bottomComment"}else $("#addCommentTip").addClass("error").html("<ul><li>"+e.msg+"</li></ul>")},error:function(e){$("#addCommentTip").addClass("error").html("<ul><li>"+e.statusText+"</li></ul>")},complete:function(){$(".form button.red").removeAttr("disabled").css("opacity","1"),Comment.editor.setOption("readOnly",!1)}})},reply:function(e,t){if(!Label.isLoggedIn)return Util.needLogin(),!1;if($.ua.set(navigator.userAgent),"mobile"===$.ua.device.type)return $("#replyUseName").data("commentOriginalCommentId",t),Comment.editor.focus(),!1;$(".footer").css("margin-bottom",$(".editor-panel").outerHeight()+"px"),"0px"!==$(".editor-panel").css("bottom")&&$(".editor-panel").hide().css("bottom",0),$(".editor-panel").slideDown(function(){$(window).height()-($("#"+t).offset().top-$(window).scrollTop())<$(".editor-panel").outerHeight()+$("#"+t).outerHeight()&&$(window).scrollTop($("#"+t).offset().top-($(window).height()-$(".editor-panel").outerHeight()-$("#"+t).outerHeight())),Comment.editor.focus()});var i="",n=$("#"+t).find(">.fn-flex>div>a").clone();0===n.length?(n=$("#"+t).find(">.fn-flex .avatar").clone(),n.removeClass("avatar").addClass("avatar-small"),i='<a rel="nofollow" href="#'+t+'" class="ft-a-title" onclick="Comment._bgFade($(\'#'+t+'\'))"><span class="icon-reply-to"></span> '+n[0].outerHTML+" "+e+"</a>"):(n.addClass("ft-a-title").attr("href","#"+t).attr("onclick",'Comment._bgFade($("#'+t+'"))'),n.find("div").removeClass("avatar").addClass("avatar-small").after(" "+e).before('<span class="icon-reply-to"></span> '),i=n[0].outerHTML),$("#replyUseName").html(i).data("commentOriginalCommentId",t)}},Article={permissionTip:function(e){Label.isLoggedIn?Util.alert(e):Util.needLogin()},voteUp:function(e,t,i){if(!Label.isLoggedIn)return Util.needLogin(),!1;var n=$(i),o=n.next();if(n.hasClass("disabled"))return!1;var r={dataId:e};n.addClass("disabled"),$.ajax({url:Label.servePath+"/vote/up/"+t,type:"POST",cache:!1,data:JSON.stringify(r),success:function(e,t){n.removeClass("disabled");var i=parseInt(n.text()),r=parseInt(o.text());return e.sc?void(0===e.type?n.html('<span class="icon-thumbs-up"></span> '+(i-1)).removeClass("ft-red"):(n.html('<span class="icon-thumbs-up"></span> '+(i+1)).addClass("ft-red"),o.hasClass("ft-red")&&o.html('<span class="icon-thumbs-down"></span> '+(r-1)).removeClass("ft-red"))):void alert(e.msg)}})},voteDown:function(e,t,i){if(!Label.isLoggedIn)return Util.needLogin(),!1;var n=$(i),o=n.prev();if(n.hasClass("disabled"))return!1;var r={dataId:e};n.addClass("disabled"),$.ajax({url:Label.servePath+"/vote/down/"+t,type:"POST",cache:!1,data:JSON.stringify(r),success:function(e,t){n.removeClass("disabled");var i=parseInt(o.text()),r=parseInt(n.text());return e.sc?(1===e.type?n.html('<span class="icon-thumbs-down"></span> '+(r-1)).removeClass("ft-red"):(n.html('<span class="icon-thumbs-down"></span> '+(r+1)).addClass("ft-red"),o.hasClass("ft-red")&&o.html('<span class="icon-thumbs-up"></span> '+(i-1)).removeClass("ft-red")),!1):void alert(e.msg)}})},init:function(){this.share(),this.parseLanguage(),$(".content-reset.article-content").on("dblclick","img",function(){return!$(this).hasClass("emoji")&&void window.open($(this).attr("src"))});var e=$("#articltVia").data("ua"),t=Util.getDeviceByUa(e);""!==t&&$("#articltVia").text("via "+t),$("#revision").dialog({width:$(window).width()-50,height:$(window).height()-50,modal:!0,hideFooter:!0}),this.initToc()},revision:function(e){return Label.isLoggedIn?$(".CodeMirror-merge").length>0?($("#revision").dialog("open"),!1):($.ajax({url:Label.servePath+"/article/"+e+"/revisions",cache:!1,success:function(e,t){return e.sc?0===e.revisions.length||1===e.revisions.length?($("#revisions").html("<b>"+Label.noRevisionLabel+"</b>"),!1):($("#revisions").data("revisions",e.revisions).before('<div class="fn-clear"><div class="pagination"><a href="javascript:void(0)">&lt;</a><span class="current">'+(e.revisions.length-1)+"~"+e.revisions.length+"/"+e.revisions.length+'</span><a href="javascript:void(0)" class="fn-none">&gt;</a></div></div>'),e.revisions.length<=2&&$("#revision a").first().hide(),Article.mergeEditor=CodeMirror.MergeView(document.getElementById("revisions"),{value:e.revisions[e.revisions.length-1].revisionData.articleTitle+"\n\n"+e.revisions[e.revisions.length-1].revisionData.articleContent,origLeft:e.revisions[e.revisions.length-2].revisionData.articleTitle+"\n\n"+e.revisions[e.revisions.length-2].revisionData.articleContent,revertButtons:!1,mode:"text/html",collapseIdentical:!0}),Article._revisionsControls(),!1):void alert(e.msg)}}),void $("#revision").dialog("open")):(Util.needLogin(),!1)},_revisionsControls:function(){var e=$("#revisions").data("revisions");$("#revision a").first().click(function(){var t=parseInt($("#revision .current").text().split("~")[0]);return t<=2?$(this).hide():$(this).show(),!(t<2)&&($("#revision a").last().show(),$("#revision .current").html(t-1+"~"+t+"/"+e.length),Article.mergeEditor.edit.setValue(e[t-1].revisionData.articleTitle+"\n\n"+e[t-1].revisionData.articleContent),void Article.mergeEditor.leftOriginal().setValue(e[t-2].revisionData.articleTitle+"\n\n"+e[t-2].revisionData.articleContent))}),$("#revision a").last().click(function(){var t=parseInt($("#revision .current").text().split("~")[0]);return t>e.length-3?$(this).hide():$(this).show(),!(t>e.length-2)&&($("#revision a").first().show(),$("#revision .current").html(t+1+"~"+(t+2)+"/"+e.length),Article.mergeEditor.edit.setValue(e[t+1].revisionData.articleTitle+"\n\n"+e[t+1].revisionData.articleContent),void Article.mergeEditor.leftOriginal().setValue(e[t].revisionData.articleTitle+"\n\n"+e[t].revisionData.articleContent))})},share:function(){var e=$("#qrCode").data("shareurl");if($("#qrCode").qrcode({width:90,height:90,text:e}),$("body").click(function(){$("#qrCode").slideUp()}),$(".share > span").click(function(){var t=$(this).data("type");if("wechat"===t)return $("#qrCode").slideToggle(),!1;if("copy"===t)return!1;var i=encodeURIComponent(Label.articleTitle+" - "+Label.symphonyLabel),n=encodeURIComponent(e),o=$(".article-info .avatar").css("background-image");pic=o.substring(5,o.length-2);var r={};r.tencent="http://share.v.t.qq.com/index.php?c=share&a=index&title="+i+"&url="+n+"&pic="+pic,r.weibo="http://v.t.sina.com.cn/share/share.php?title="+i+"&url="+n+"&pic="+pic,r.google="https://plus.google.com/share?url="+n,r.twitter="https://twitter.com/intent/tweet?status="+i+" "+n,window.open(r[t],"_blank","top=100,left=200,width=648,height=618")}),$("#qrCode").click(function(){$(this).hide()}),"undefined"!=typeof ZeroClipboard){$("#shareClipboard").mouseover(function(){$(this).attr("aria-label",Label.copyLabel)}),ZeroClipboard.config({hoverClass:"tooltipped-hover",swfPath:Label.staticServePath+"/js/lib/zeroclipboard/ZeroClipboard.swf"});var t=new ZeroClipboard(document.getElementById("shareClipboard"));t.on("ready",function(e){t.on("aftercopy",function(e){$("#shareClipboard").attr("aria-label",Label.copiedLabel)})})}},parseLanguage:function(){$("pre code").each(function(e,t){hljs.highlightBlock(t)})},reward:function(e){var t=confirm(Label.rewardConfirmLabel);t&&$.ajax({url:Label.servePath+"/article/reward?articleId="+e,type:"POST",cache:!1,success:function(e,t){if(e.sc){$("#articleRewardContent").removeClass("reward").html(e.articleRewardContent),Article.parseLanguage();var i=parseInt($(".article-actions .icon-points").parent().text());return void $(".article-actions .icon-points").parent().addClass("ft-red").html('<span class="icon-points"></span> '+(i+1)).removeAttr("onclick")}alert(e.msg)},error:function(e){Util.needLogin()}})},thankArticle:function(e,t){return Label.isLoggedIn?!(0===t&&!confirm(Label.thankArticleConfirmLabel))&&(Label.currentUserName===Label.articleAuthorName?(alert(Label.thankSelfLabel),!1):void $.ajax({url:Label.servePath+"/article/thank?articleId="+e,type:"POST",cache:!1,success:function(e,t){if(e.sc){var i=parseInt($("#thankArticle").text());$("#thankArticle").removeAttr("onclick").html('<span class="icon-heart"></span> '+(i+1)).addClass("ft-red");var n=$("<i class='icon-heart ft-red'></i>"),o=$("#thankArticle").offset().top,r=$("#thankArticle").offset().left;return n.css({"z-index":9999,top:o-20,left:r,position:"absolute","font-size":16,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),$("body").append(n),n.animate({top:o-180,opacity:0},1500,function(){n.remove()}),!1}alert(e.msg)}})):(Util.needLogin(),!1)},stick:function(e){var t=confirm(Label.stickConfirmLabel);t&&$.ajax({url:Label.servePath+"/article/stick?articleId="+e,type:"POST",cache:!1,success:function(e,t){alert(e.msg),window.location.href=Label.servePath+"/recent"}})},playThought:function(e){var t=2,i=function(e,t){var i=e.split("");3===i.length&&i.splice(0,0,"");var n=i[0],o=i[2].split("-"),r=i[3].split("-");if(o[0]=parseInt(o[0]),o[1]=parseInt(o[1]),r[0]=parseInt(r[0]),r[1]=parseInt(r[1]),""===n){for(var a=[],s=o[1],l=0;s<=r[1];s++,l++){if(o[1]===r[1]){t[s]=t[s].substring(0,o[0])+t[s].substr(r[0]);break}s===o[1]?t[s]=t[s].substr(0,o[0]):s===r[1]?(t[o[1]]+=t[s].substr(r[0]),t.splice(s,1)):a.push(s)}for(var c=0;c<a.length;c++)t.splice(a[c]-c,1)}else{var d=n.split(String.fromCharCode(29))[0],m=n.split(String.fromCharCode(29))[1];""===m&&(t[o[1]]=t[o[1]].substring(0,o[0])+t[r[1]].substr(r[0])),t[o[1]]=t[o[1]].substring(0,o[0])+d+t[o[1]].substr(o[0])}return t},n=e.split("");""===n[n.length-1]&&n.pop();for(var o=0,r=0;o<n.length;o++)setTimeout(function(){$(".article-content").data("text")||$(".article-content").data("text","");var e=i(n[r++],$(".article-content").data("text").split(String.fromCharCode(10))),t=e.join(String.fromCharCode(10)),o=t.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/	/g,"&nbsp;&nbsp;&nbsp;&nbsp;");$(".article-content").data("text",t).html(o)},parseInt(n[o].split("")[1])/t);for(var a=0,s=20,l=parseInt(n[o-1].split("")[1])/t+6*s,c=setInterval(function(){a>=l?($("#thoughtProgress .bar").width("100%"),$("#thoughtProgress .icon-video").css("left","100%"),clearInterval(c)):(a+=s,$("#thoughtProgress .icon-video").css("left",100*a/l+"%"),$("#thoughtProgress .bar").width(100*a/l+"%"))},s),d=0,m=0;d<n.length;d++){var u=i(n[m++],$("#thoughtProgressPreview").data("text").split(String.fromCharCode(10))),p=u.join(String.fromCharCode(10)),h=p.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/	/g,"&nbsp;&nbsp;&nbsp;&nbsp;");$("#thoughtProgressPreview").data("text",p).html(h)}$("#thoughtProgressPreview").dialog({modal:!0,hideFooter:!0}),$("#thoughtProgress .icon-video").click(function(){$("#thoughtProgressPreview").dialog("open")}),$(".article-content").html(h).height($(".article-content").height()).html("")},initToc:function(){if(0===$("#articleToC").length)return!1;$(".side").height($(".side").height());var e=$("#articleToC"),t=$(".article-toc"),i=$(".article-content [id^=toc]"),n=!1,o=e.offset().top;e.css("width",$(".side").width()+"px"),e.next().css({width:$(".side").width()+"px",top:e.height()+41+"px"}),t.css({overflow:"auto","max-height":$(window).height()-90+"px",position:"relative"}),e.find("li").click(function(){var t=$(this);setTimeout(function(){e.find("li").removeClass("current"),t.addClass("current")},50)}),$(window).scroll(function(r){if("none"===$("#articleToC").css("display"))return!1;toc=[],i.each(function(e){toc.push({id:this.id,offsetTop:this.offsetTop})});for(var a=$(window).scrollTop(),s=0,l=toc.length;s<l;s++)if(a<toc[s].offsetTop-5){e.find("li").removeClass("current");var c=s>0?s-1:0;e.find('a[href="#'+toc[c].id+'"]').parent().addClass("current");break}a>=toc[toc.length-1].offsetTop-5&&(e.find("li").removeClass("current"),e.find("li:last").addClass("current")),$(window).scrollTop()>o-20?(e.css("position","fixed"),e.next().css("position","fixed")):(e.css("position","initial"),e.next().css("position","initial"));var d=e.find("li.current")[0].offsetTop;n||(t.scrollTop()<d-t.height()+30&&t.scrollTop(d-t.height()+30),t.scrollTop()>d-30&&t.scrollTop(d)),setTimeout(function(){n=!1},600)}).resize(function(){e.css("width",$(".side").width()+"px"),e.next().css({width:$(".side").width()+"px"})}),$(window).scroll(),t.scrollTop(e.find("li.current")[0].offsetTop).scroll(function(){n=!0})},toggleToc:function(){var e=$("#articleToC");if(0===e.length)return!1;var t=$(".article-actions .icon-unordered-list");t.hasClass("ft-red")?(e.hide(),t.removeClass("ft-red"),e.css("position","initial"),e.next().css("position","initial"),$(".side").height("auto")):(e.show(),t.addClass("ft-red"),$(window).scrollTop()>$("#articleToC").offset().top-20&&(e.css("position","fixed"),e.next().css("position","fixed")),$(".side").height($(".side").height()))},makeNotificationRead:function(e,t){var i={articleId:e,commentIds:t};$.ajax({url:Label.servePath+"/notification/read",type:"POST",cache:!1,data:JSON.stringify(i)})}};Article.init();