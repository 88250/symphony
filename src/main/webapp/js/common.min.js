function arraycopy(e,a,t,o,n){for(i=0;i<n;i++)t[o+i]=e[a+i]}function arrayEquals(e,a){if("undefined"==e||"undefined"==a)return!1;if(e instanceof Array&&a instanceof Array){if(e.length!=a.length)return!1;for(i=0;i<e.length;i++)if(e[i]!=a[i])return!1;return!0}return!1}function isImage(e){return null!==getImageMime(e)}function getImageMime(e){if(null==e||"undefined"==e||e.length<8)return null;var a=[];return arraycopy(e,0,a,0,6),isGif(a)?"image/gif":(a=[],arraycopy(e,6,a,0,4),isJpeg(a)?"image/jpeg":(a=[],arraycopy(e,0,a,0,8),isPng(a)?"image/png":null))}function isAudio(e){if(null==e||"undefined"==e||e.length<12)return null;var a=[];arraycopy(e,0,a,0,4);var t=[];return arraycopy(e,8,t,0,4),isWav(a,t)?"audio/wav":null}function isGif(e){return arrayEquals(e,gifMagic0)||arrayEquals(e,getGifMagic1)}function isJpeg(e){return arrayEquals(e,jpegMagic)||arrayEquals(e,jpeg_jfif)||arrayEquals(e,jpeg_exif)}function isPng(e){return arrayEquals(e,pngMagic)}function isWav(e,a){return arrayEquals(e,wavMagic1)&&arrayEquals(a,wavMagic2)}function getUUID(){var e=(new Date).getTime(),a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==a?t:3&t|8).toString(16)});return a=a.replace(new RegExp("-","g"),"")}var Util={prevKey:void 0,clipboard:function(e,a,t){e.click(function(e){a[0].select();try{document.execCommand("copy")?t():console.log("Copy command was unsuccessful")}catch(e){console.log("Oops, unable to copy")}window.getSelection().removeAllRanges()})},closeAlert:function(){var e=$("#alertDialogPanel");e.prev().remove(),e.remove()},alert:function(e){var a="";a='<div onclick="Util.closeAlert(this)" style="height: '+document.documentElement.scrollHeight+'px;display: block;" class="dialog-background"></div><div class="dialog-panel" id="alertDialogPanel" tabindex="0" onkeyup="Util.closeAlert()"><div class="fn-clear dialog-header-bg"><a class="icon-close" href="javascript:void(0);" onclick="Util.closeAlert()"><svg><use xlink:href="#close"></use></svg></a></div><div class="dialog-main" style="text-align:center;padding: 30px 10px 40px">'+e+"</div></div>",$("body").append(a),$("#alertDialogPanel").css({top:($(window).height()-$("#alertDialogPanel").height())/2+"px",left:($(window).width()-$("#alertDialogPanel").width())/2+"px",outline:"none"}).show().focus()},makeNotificationRead:function(e){$.ajax({url:Label.servePath+"/notification/read/"+e,type:"GET",cache:!1,success:function(e,a){e.sc&&window.location.reload()}})},_initCommonHotKey:function(){if(!Label.userKeyboardShortcutsStatus||"1"===Label.userKeyboardShortcutsStatus)return!1;var e=function(e){var a=$(".list > ul > li.focus"),t=0===$(".radio-btn").length?0:48;if(1===a.length){if("top"===e||"bottom"===e)return $(window).scrollTop(a.offset().top-t),!1;($(window).height()+$(window).scrollTop()<a.offset().top+a.outerHeight()||$(window).scrollTop()>a.offset().top)&&("down"===e?$(window).scrollTop(a.offset().top-($(window).height()-a.outerHeight())):$(window).scrollTop(a.offset().top-t))}};0===$("#articleTitle").length&&$(document).bind("keydown","c",function(e){return!Util.prevKey&&(window.location=Label.servePath+"/post?type=0",!1)}),$(document).bind("keyup","g",function(){return Util.prevKey="g",setTimeout(function(){Util.prevKey=void 0},1e3),!1}).bind("keyup","s",function(){return $("#search").focus(),!1}).bind("keyup","t",function(){return void 0===Util.prevKey&&Util.goTop(),!1}).bind("keyup","n",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/notifications"),!1}).bind("keyup","h",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/hot"),!1}).bind("keyup","i",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath),!1}).bind("keyup","r",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/recent"),!1}).bind("keyup","p",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/perfect"),!1}).bind("keyup","t",function(e){return"g"===Util.prevKey&&(window.location=Label.servePath+"/timeline"),!1}).bind("keyup","Shift+/",function(e){return window.open("https://hacpai.com/article/1474030007391"),!1}).bind("keyup","j",function(a){var t=".content .list:last > ul > ";1===$("#comments").length&&(t="#comments .list > ul > ");var o=$(t+"li.focus");return 0===o.length?$(t+"li:first").addClass("focus"):1===o.next().length&&(o.next().addClass("focus"),o.removeClass("focus")),e("down"),!1}).bind("keyup","k",function(a){var t=".content .list:last > ul > ";1===$("#comments").length&&(t="#comments .list > ul > ");var o=$(t+"li.focus");return 0===o.length?$(t+"li:last").addClass("focus"):1===o.prev().length&&(o.prev().addClass("focus"),o.removeClass("focus")),e("up"),!1}).bind("keyup","f",function(a){var t=".content .list:last > ul > ";return 1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:first").addClass("focus"),e("top"),!1}).bind("keyup","l",function(a){if(Util.prevKey)return!1;var t=".content .list:last > ul > ";return 1===$("#comments").length&&(t="#comments .list > ul > "),$(t+"li.focus").removeClass("focus"),$(t+"li:last").addClass("focus"),e("bottom"),!1}).bind("keyup","o",function(e){if(1===$("#comments").length)return!1;var a=$(".content .list:last > ul > li.focus > h2 > a").attr("href");return a||(a=$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href")),a||(a=$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href")),a&&(window.location=a),!1}).bind("keyup","return",function(e){if(1===$("#comments").length)return!1;var a=$(".content .list:last > ul > li.focus > h2 > a").attr("href");return a||(a=$(".content .list:last > ul > li.focus .fn-flex-1 > h2 > a").attr("href")),a||(a=$(".content .list:last > ul > li.focus h2.fn-flex-1 > a").attr("href")),a&&(window.location=a),!1})},notifyMsg:function(e){if(!("Notification"in window))return!1;var a=function(e){var a=new Notification(Label.visionLabel,{body:Label.desktopNotificationTemplateLabel.replace("${count}",e),icon:Label.staticServePath+"/images/faviconH.png"});a.onclick=a.onerror=function(){window.location=Label.servePath+"/notifications"}};"granted"===Notification.permission?a(e):"denied"!==Notification.permission&&Notification.requestPermission(function(t){"granted"===t&&a(e)})},linkForge:function(){$(".link-forge .module-header > a").click(function(){var e=$(this).closest(".module").find(".module-panel");if("hidden"!==e.css("overflow"))return e.css({"max-height":"409px",overflow:"hidden"}),!1;e.css({"max-height":"inherit",overflow:"inherit"})});var e=function(){if(!Label.isLoggedIn)return Util.needLogin(),!1;Validate.goValidate({target:$("#uploadLinkTip"),data:[{target:$(".link-forge-upload input"),type:"url",msg:Label.invalidUserURLLabel}]})&&$.ajax({url:Label.servePath+"/forge/link",type:"POST",cache:!1,data:JSON.stringify({url:$(".link-forge-upload input").val()}),error:function(e,a,t){alert(t)},success:function(e,a){e.sc?($("#uploadLinkTip").html("<ul><li>"+Label.forgeUploadSuccLabel+"</li></ul>").addClass("succ"),$(".link-forge-upload input").val(""),setTimeout(function(){$("#uploadLinkTip").html("").removeClass("succ")},5e3)):alert(e.msg)}})};$(".link-forge-upload button").click(function(){e()}),$(".link-forge-upload input").focus().keypress(function(a){if(13===a.which)return e(),!1;Validate.goValidate({target:$("#uploadLinkTip"),data:[{target:$(".link-forge-upload input"),type:"url",msg:Label.invalidUserURLLabel}]})})},processClipBoard:function(e,a){if(""===e.getData("text/html")&&2===e.items.length)return"";var t=toMarkdown(e.getData("text/html"),{converters:[{filter:"img",replacement:function(e,t){if(1===t.attributes.length)return"";var o={url:t.src};return $.ajax({url:Label.servePath+"/fetch-upload",type:"POST",data:JSON.stringify(o),cache:!1,success:function(e,t){if(e.sc){var o=a.getValue();o=o.replace(e.originalURL,e.url),a.setValue(o)}}}),"![]("+t.src+")"}}],gfm:!0}),o=t.split("```");if(o.length>1)for(var i=0,n=o.length;i<n;i++)i%2==1&&(o[i]=o[i].replace(/<\/span><span style="color:#\w{6};">/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;"));return t=o.join("```"),t=t.replace(/<img/gi,"&lt;img"),t=$("<div>"+t+"</div>").text().replace(/\n{2,}/g,"\n\n").replace(/ /g," "),$.trim(t)},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=a.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getDeviceByUa:function(e){$.ua.set(e);var a=$.ua.device.model?$.ua.device.model:$.ua.os.name;return a&&"Windows"!==a||(a=""),a},initSearch:function(e,a,t){var o=algoliasearch(e,a),i=o.initIndex(t);$("#search").autocomplete({hint:!1,templates:{footer:'<div class="fn-right fn-pointer" onclick="window.open(\'https://www.algolia.com/referrals/1faf0d17/join\')"><span class="ft-gray">With &hearts; from</span> <img src="'+Label.staticServePath+'/images/services/algolia128x40.png" /> </div>'}},[{source:function(e,a){i.search(e,{hitsPerPage:20},function(e,t){if(e)return void a([]);a(t.hits,t)})},displayKey:"name",templates:{suggestion:function(e){return e._highlightResult.articleTitle.value}}}]).on("autocomplete:selected",function(e,a,t){window.open("/article/"+a.oId)}).bind("keyup","esc",function(){$(this).blur()})},initTextarea:function(e,a){var t={$it:$("#"+e),setValue:function(e){this.$it.val(e)},getValue:function(){return this.$it.val()},setOption:function(e,a){this.$it.prop(e,a)},focus:function(){this.$it.focus()},setCursor:function(){this.$it[0].setSelectionRange(0,0)}};return a&&"function"==typeof a&&t.$it.keyup(function(){a(t)}),t},initCodeMirror:function(){var e=Util.allEmoj="smile,laughing,blush,smiley,relaxed,smirk,heart_eyes,kissing_heart,kissing_closed_eyes,flushed,relieved,satisfied,grin,wink,stuck_out_tongue_winking_eye,stuck_out_tongue_closed_eyes,grinning,kissing,kissing_smiling_eyes,stuck_out_tongue,sleeping,worried,frowning,anguished,open_mouth,grimacing,confused,hushed,expressionless,unamused,sweat_smile,sweat,disappointed_relieved,weary,pensive,disappointed,confounded,fearful,cold_sweat,persevere,cry,sob,joy,astonished,scream,tired_face,angry,rage,triumph,sleepy,yum,mask,sunglasses,dizzy_face,imp,smiling_imp,neutral_face,no_mouth,innocent,alien,yellow_heart,blue_heart,purple_heart,heart,green_heart,broken_heart,heartbeat,heartpulse,two_hearts,revolving_hearts,cupid,sparkling_heart,sparkles,star,star2,dizzy,boom,collision,anger,exclamation,question,grey_exclamation,grey_question,zzz,dash,sweat_drops,notes,musical_note,fire,poop,+1,thumbsup,-1,thumbsdown,ok_hand,punch,facepunch,fist,v,wave,hand,raised_hand,open_hands,point_up,point_down,point_left,point_right,raised_hands,pray,point_up_2,clap,muscle,couple,family,two_men_holding_hands,two_women_holding_hands,dancer,dancers,ok_woman,no_good,information_desk_person,raising_hand,bride_with_veil,person_with_pouting_face,person_frowning,bow,couplekiss,couple_with_heart,massage,haircut,nail_care,boy,girl,woman,man,baby,older_woman,older_man,person_with_blond_hair,man_with_gua_pi_mao,man_with_turban,construction_worker,cop,angel,princess,smiley_cat,smile_cat,heart_eyes_cat,kissing_cat,smirk_cat,scream_cat,crying_cat_face,joy_cat,pouting_cat,japanese_ogre,japanese_goblin,see_no_evil,hear_no_evil,speak_no_evil,guardsman,skull,feet,lips,kiss,droplet,ear,eyes,nose,tongue,love_letter,bust_in_silhouette,busts_in_silhouette,speech_balloon,thought_balloon,trollface,sunny,umbrella,cloud,snowflake,snowman,zap,cyclone,foggy,ocean,cat,dog,mouse,hamster,rabbit,wolf,frog,tiger,koala,bear,pig,pig_nose,cow,boar,monkey_face,monkey,horse,racehorse,camel,sheep,elephant,panda_face,snake,bird,baby_chick,hatched_chick,hatching_chick,chicken,penguin,turtle,bug,honeybee,ant,beetle,snail,octopus,tropical_fish,fish,whale,whale2,dolphin,cow2,ram,rat,water_buffalo,tiger2,rabbit2,dragon,goat,rooster,dog2,pig2,mouse2,ox,dragon_face,blowfish,crocodile,dromedary_camel,leopard,cat2,poodle,paw_prints,bouquet,cherry_blossom,tulip,four_leaf_clover,rose,sunflower,hibiscus,maple_leaf,leaves,fallen_leaf,herb,mushroom,cactus,palm_tree,evergreen_tree,deciduous_tree,chestnut,seedling,blossom,ear_of_rice,shell,globe_with_meridians,sun_with_face,full_moon_with_face,new_moon_with_face,new_moon,waxing_crescent_moon,first_quarter_moon,waxing_gibbous_moon,full_moon,waning_gibbous_moon,last_quarter_moon,waning_crescent_moon,last_quarter_moon_with_face,first_quarter_moon_with_face,crescent_moon,earth_africa,earth_americas,earth_asia,volcano,milky_way,partly_sunny,octocat,squirrel,bamboo,gift_heart,dolls,school_satchel,mortar_board,flags,fireworks,sparkler,wind_chime,rice_scene,jack_o_lantern,ghost,santa,christmas_tree,gift,bell,no_bell,tanabata_tree,tada,confetti_ball,balloon,crystal_ball,cd,dvd,floppy_disk,camera,video_camera,movie_camera,computer,tv,iphone,phone,telephone,telephone_receiver,pager,fax,minidisc,vhs,sound,speaker,mute,loudspeaker,mega,hourglass,hourglass_flowing_sand,alarm_clock,watch,radio,satellite,loop,mag,mag_right,unlock,lock,lock_with_ink_pen,closed_lock_with_key,key,bulb,flashlight,high_brightness,low_brightness,electric_plug,battery,calling,email,mailbox,postbox,bath,bathtub,shower,toilet,wrench,nut_and_bolt,hammer,seat,moneybag,yen,dollar,pound,euro,credit_card,money_with_wings,e-mail,inbox_tray,outbox_tray,envelope,incoming_envelope,postal_horn,mailbox_closed,mailbox_with_mail,mailbox_with_no_mail,package,door,smoking,bomb,gun,hocho,pill,syringe,page_facing_up,page_with_curl,bookmark_tabs,bar_chart,chart_with_upwards_trend,chart_with_downwards_trend,scroll,clipboard,calendar,date,card_index,file_folder,open_file_folder,scissors,pushpin,paperclip,black_nib,pencil2,straight_ruler,triangular_ruler,closed_book,green_book,blue_book,orange_book,notebook,notebook_with_decorative_cover,ledger,books,bookmark,name_badge,microscope,telescope,newspaper,football,basketball,soccer,baseball,tennis,8ball,rugby_football,bowling,golf,mountain_bicyclist,bicyclist,horse_racing,snowboarder,swimmer,surfer,ski,spades,hearts,clubs,diamonds,gem,ring,trophy,musical_score,musical_keyboard,violin,space_invader,video_game,black_joker,flower_playing_cards,game_die,dart,mahjong,clapper,memo,pencil,book,art,microphone,headphones,trumpet,saxophone,guitar,shoe,sandal,high_heel,lipstick,boot,shirt,tshirt,necktie,womans_clothes,dress,running_shirt_with_sash,jeans,kimono,bikini,ribbon,tophat,crown,womans_hat,mans_shoe,closed_umbrella,briefcase,handbag,pouch,purse,eyeglasses,fishing_pole_and_fish,coffee,tea,sake,baby_bottle,beer,beers,cocktail,tropical_drink,wine_glass,fork_and_knife,pizza,hamburger,fries,poultry_leg,meat_on_bone,spaghetti,curry,fried_shrimp,bento,sushi,fish_cake,rice_ball,rice_cracker,rice,ramen,stew,oden,dango,egg,bread,doughnut,custard,icecream,ice_cream,shaved_ice,birthday,cake,cookie,chocolate_bar,candy,lollipop,honey_pot,apple,green_apple,tangerine,lemon,cherries,grapes,watermelon,strawberry,peach,melon,banana,pear,pineapple,sweet_potato,eggplant,tomato,corn,house,house_with_garden,school,office,hospital,bank,convenience_store,love_hotel,hotel,wedding,church,department_store,european_post_office,city_sunrise,city_sunset,japanese_castle,european_castle,tent,factory,tokyo_tower,japan,mount_fuji,sunrise_over_mountains,sunrise,stars,statue_of_liberty,bridge_at_night,carousel_horse,rainbow,ferris_wheel,fountain,roller_coaster,ship,speedboat,boat,sailboat,rowboat,anchor,rocket,airplane,helicopter,steam_locomotive,tram,mountain_railway,bike,aerial_tramway,suspension_railway,mountain_cableway,tractor,blue_car,oncoming_automobile,car,red_car,taxi,oncoming_taxi,articulated_lorry,bus,oncoming_bus,rotating_light,police_car,oncoming_police_car,fire_engine,ambulance,minibus,truck,train,station,train2,bullettrain_front,bullettrain_side,light_rail,monorail,railway_car,trolleybus,ticket,fuelpump,vertical_traffic_light,traffic_light,warning,construction,beginner,atm,slot_machine,busstop,barber,hotsprings,checkered_flag,crossed_flags,izakaya_lantern,moyai,circus_tent,performing_arts,round_pushpin,triangular_flag_on_post,jp,kr,cn,us,fr,es,it,ru,gb,de,one,two,three,four,five,six,seven,eight,nine,keycap_ten,1234,zero,hash,symbols,arrow_backward,arrow_down,arrow_forward,arrow_left,capital_abcd,abcd,abc,arrow_lower_left,arrow_lower_right,arrow_right,arrow_up,arrow_upper_left,arrow_upper_right,arrow_double_down,arrow_double_up,arrow_down_small,arrow_heading_down,arrow_heading_up,leftwards_arrow_with_hook,arrow_right_hook,left_right_arrow,arrow_up_down,arrow_up_small,arrows_clockwise,arrows_counterclockwise,rewind,fast_forward,information_source,ok,twisted_rightwards_arrows,repeat,repeat_one,new,top,up,cool,free,ng,cinema,koko,signal_strength,u5272,u5408,u55b6,u6307,u6708,u6709,u6e80,u7121,u7533,u7a7a,u7981,sa,restroom,mens,womens,baby_symbol,no_smoking,parking,wheelchair,metro,baggage_claim,accept,wc,potable_water,put_litter_in_its_place,secret,congratulations,m,passport_control,left_luggage,customs,ideograph_advantage,cl,sos,id,no_entry_sign,underage,no_mobile_phones,do_not_litter,non-potable_water,no_bicycles,no_pedestrians,children_crossing,no_entry,eight_spoked_asterisk,sparkle,eight_pointed_black_star,heart_decoration,vs,vibration_mode,mobile_phone_off,chart,currency_exchange,aries,taurus,gemini,cancer,leo,virgo,libra,scorpius,sagittarius,capricorn,aquarius,pisces,ophiuchus,six_pointed_star,negative_squared_cross_mark,a,b,ab,o2,diamond_shape_with_a_dot_inside,recycle,end,back,on,soon,clock1,clock130,clock10,clock1030,clock11,clock1130,clock12,clock1230,clock2,clock230,clock3,clock330,clock4,clock430,clock5,clock530,clock6,clock630,clock7,clock730,clock8,clock830,clock9,clock930,heavy_dollar_sign,copyright,registered,tm,x,heavy_exclamation_mark,bangbang,interrobang,o,heavy_multiplication_x,heavy_plus_sign,heavy_minus_sign,heavy_division_sign,white_flower,100,heavy_check_mark,ballot_box_with_check,radio_button,link,curly_loop,wavy_dash,part_alternation_mark,trident,black_small_square,white_small_square,black_medium_small_square,white_medium_small_square,black_medium_square,white_medium_square,black_large_square,white_large_square,white_check_mark,black_square_button,white_square_button,black_circle,white_circle,red_circle,large_blue_circle,large_blue_diamond,large_orange_diamond,small_blue_diamond,small_orange_diamond,small_red_triangle,small_red_triangle_down,unicorn_face",a="";if($.ajax({url:Label.servePath+"/users/emotions",type:"GET",success:function(t){if(""===(a=t.emotions))a=e;else{for(var o=a.split(","),i=0;i<o.length;i++)e=e.replace(o[i]+",",",");a=a+","+e}a=a.replace(/,+/g,",");for(var n=a.split(/,/),r=[],l=0;l<n.length;l++){var s=n[l],c=n[l];r.push({displayText:"<span>"+s+'&nbsp;<img style="width: 16px" src="'+Label.staticServePath+"/emoji/graphics/"+c+'.png"></span>',text:c+": "})}CodeMirror.registerHelper("hint","emoji",function(e){for(var a=/[\w$]+/,t=e.getCursor(),o=e.getLine(t.line),i=t.ch,r=i;r<o.length&&a.test(o.charAt(r));)++r;for(;i&&a.test(o.charAt(i-1));)--i;for(var l=e.getTokenAt(t),s=[],c=l.string.trim(),u=0,d=0;d<n.length;d++){var f=n[d],g=n[d];if(Util.startsWith(g,c)&&(s.push({displayText:'<span style="font-size: 1rem;line-height:22px"><img style="width: 1rem;margin:3px 0;float:left" src="'+Label.staticServePath+"/emoji/graphics/"+g+'.png"> '+f.toString()+"</span>",text:":"+g+": "}),u++),u>10)break}return{list:s,from:CodeMirror.Pos(t.line,i),to:CodeMirror.Pos(t.line,r)}})}}),Label.commonAtUser&&"true"===Label.commonAtUser){var t=function(e,a){for(var t=/[\w$]+/,o=e.getCursor(),i=e.getLine(o.line),n=o.ch,r=n;r<i.length&&t.test(i.charAt(r));)++r;for(;n&&t.test(i.charAt(n-1));)--n;var l=e.getTokenAt(o),s=[];if(0!==l.string.indexOf("@"))return!1;$.ajax({url:Label.servePath+"/users/names?name="+l.string.substring(1),type:"GET",success:function(t){if(t.sc&&t.userNames){for(var i=0;i<t.userNames.length;i++){var c=t.userNames[i],u=c.userName,d=c.userAvatarURL;s.push({displayText:"<span style='font-size: 1rem;line-height:22px'><img style='width: 1rem;height: 1rem;margin:3px 0;float:left' src='"+d+"'> "+u+"</span>",text:u+" "})}"comment"===e.for&&"@participants".indexOf(l.string)>-1&&s.push({displayText:"<span style='font-size: 1rem;line-height:22px'><img style='width: 1rem;height: 1rem;margin:3px 0;float:left' src='/images/user-thumbnail.png'> @参与者</span>",text:"participants "}),a({list:s,from:CodeMirror.Pos(o.line,n),to:CodeMirror.Pos(o.line,r)})}}})};t.async=!0,CodeMirror.registerHelper("hint","userName",t)}CodeMirror.commands.autocompleteUserName=function(e){return e.showHint({hint:CodeMirror.hint.userName,completeSingle:!1}),CodeMirror.Pass},CodeMirror.commands.autocompleteEmoji=function(e){return e.showHint({hint:CodeMirror.hint.emoji,completeSingle:!1}),CodeMirror.Pass},CodeMirror.commands.startAudioRecord=function(e){if(Audio.availabel||Audio.init(function(){var a=e.getCursor();e.replaceRange(Label.audioRecordingLabel,a),Audio.handleStartRecording()}),Audio.availabel){var a=e.getCursor();e.replaceRange(Label.audioRecordingLabel,a),Audio.handleStartRecording()}},CodeMirror.commands.endAudioRecord=function(e){if(Audio.availabel){Audio.handleStopRecording();var a=e.getCursor();e.replaceRange(Label.uploadingLabel,CodeMirror.Pos(a.line,a.ch-Label.audioRecordingLabel.length),a);var t=Audio.wavFileBlob.getDataBlob(),o=Math.floor(100*Math.random())+""+(new Date).getTime()+Math.floor(100*Math.random())+".wav",i=new FileReader;i.onload=function(a){if(""!==Label.qiniuUploadToken){var i=new FormData;i.append("token",Label.qiniuUploadToken),i.append("file",t),i.append("key",o),$.ajax({type:"POST",url:"https://up.qbox.me/",data:i,processData:!1,contentType:!1,paramName:"file",success:function(a){var t=e.getCursor();e.replaceRange('<audio controls="controls" src="'+Label.qiniuDomain+"/"+o+'"></audio>\n\n',CodeMirror.Pos(t.line,t.ch-Label.uploadingLabel.length),t)},error:function(a,t,o){alert("Error: "+o);var i=e.getCursor();e.replaceRange("",CodeMirror.Pos(i.line,i.ch-Label.uploadingLabel.length),i)}})}else{var i=new FormData;i.append("file",t),i.append("key",o),$.ajax({type:"POST",url:Label.servePath+"/upload",data:i,processData:!1,contentType:!1,paramName:"file",success:function(a){var t=e.getCursor();e.replaceRange('<audio controls="controls" src="'+a.key+'"></audio>\n\n',CodeMirror.Pos(t.line,t.ch-Label.uploadingLabel.length),t)},error:function(a,t,o){alert("Error: "+o);var i=e.getCursor();e.replaceRange("",CodeMirror.Pos(i.line,i.ch-Label.uploadingLabel.length),i)}})}},i.readAsDataURL(t)}}},setUnreadNotificationCount:function(){$.ajax({url:Label.servePath+"/notification/unread/count",type:"GET",cache:!1,success:function(e,a){var t=function(e){var a="",t='<span onclick="Util.makeNotificationRead(\'${markReadType}\');return false;" aria-label="'+Label.makeAsReadLabel+'" class="fn-right tooltipped tooltipped-nw"><svg><use xlink:href="#check"></use></svg></span>';return e.unreadCommentedNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/commented">'+Label.notificationCommentedLabel+' <span class="count">'+e.unreadCommentedNotificationCnt+"</span>"+t.replace("${markReadType}","commented")+"</a></li>"),e.unreadReplyNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/reply">'+Label.notificationReplyLabel+' <span class="count">'+e.unreadReplyNotificationCnt+"</span>"+t.replace("${markReadType}","reply")+"</a></li>"),e.unreadAtNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/at">'+Label.notificationAtLabel+' <span class="count">'+e.unreadAtNotificationCnt+"</span>"+t.replace("${markReadType}","at")+"</a></li>"),e.unreadFollowingNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/following">'+Label.notificationFollowingLabel+' <span class="count">'+e.unreadFollowingNotificationCnt+"</span>"+t.replace("${markReadType}","following")+"</a></li>"),e.unreadPointNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/point">'+Label.pointLabel+' <span class="count">'+e.unreadPointNotificationCnt+"</span></a></li>"),e.unreadBroadcastNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/broadcast">'+Label.sameCityLabel+' <span class="count">'+e.unreadBroadcastNotificationCnt+"</span></a></li>"),e.unreadSysAnnounceNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+'/notifications/sys-announce">'+Label.systemLabel+' <span class="count">'+e.unreadSysAnnounceNotificationCnt+"</span></a></li>"),e.unreadNewFollowerNotificationCnt>0&&(a+='<li><a href="'+Label.servePath+"/member/"+Label.currentUserName+'/followers">'+Label.newFollowerLabel+' <span class="count">'+e.unreadNewFollowerNotificationCnt+"</span></a></li>"),a},o=e.unreadNotificationCnt;if($.ua.set(navigator.userAgent),$.ua.device.type&&"mobile"===$.ua.device.type){if(0<o){$("#aNotifications").removeClass("no-msg").addClass("msg").text(o).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==o.toString()&&(Util.notifyMsg(o),window.localStorage.hadNotificate=o);var i=t(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(i),!1;$(".main:first").prepend('<div id="notificationsPanel" class="tab-current fn-clear fn-none"><ul class="tab fn-clear">'+i+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").slideToggle()})}else window.localStorage.hadNotificate="false",$("#aNotifications").removeClass("msg").addClass("no-msg").text(o).attr("href",Label.servePath+"/notifications");return!1}if(0<o){$("#aNotifications").removeClass("no-msg tooltipped tooltipped-w").addClass("msg").text(o).attr("href","javascript:void(0)"),0===e.userNotifyStatus&&window.localStorage.hadNotificate!==o.toString()&&(Util.notifyMsg(o),window.localStorage.hadNotificate=o);var i=t(e);if(1===$("#notificationsPanel").length)return $("#notificationsPanel ul").html(i),!1;$("#aNotifications").after('<div id="notificationsPanel" class="module person-list"><ul>'+i+"</ul></div>"),$("#aNotifications").click(function(){$("#notificationsPanel").show()}),$("body").click(function(e){"aNotifications"!==e.target.id&&"notificationsPanel"!==$(e.target).closest(".module").attr("id")&&$("#notificationsPanel").hide()})}else window.localStorage.hadNotificate="false",$("#notificationsPanel").remove(),$("#aNotifications").removeClass("msg").addClass("no-msg tooltipped tooltipped-w").text(o).attr("href",Label.servePath+"/notifications")}})},follow:function(e,a,t,o){if(!Label.isLoggedIn)return Util.needLogin(),!1;if($(e).hasClass("disabled"))return!1;var i={followingId:a};$(e).addClass("disabled"),$.ajax({url:Label.servePath+"/follow/"+t,type:"POST",cache:!1,data:JSON.stringify(i),success:function(i,n){i.sc&&($(e).removeClass("disabled"),void 0!==o?"article"===t||"tag"===t?$(e).html('<span class="icon-star"></span> '+(o+1)).attr("onclick","Util.unfollow(this, '"+a+"', '"+t+"', "+(o+1)+")").attr("aria-label",Label.uncollectLabel).addClass("ft-red"):"article-watch"===t&&$(e).html('<span class="icon-view"></span> '+(o+1)).attr("onclick","Util.unfollow(this, '"+a+"', '"+t+"', "+(o+1)+")").attr("aria-label",Label.unfollowLabel).addClass("ft-red"):$(e).attr("onclick","Util.unfollow(this, '"+a+"', '"+t+"')").text("article"===t?Label.uncollectLabel:Label.unfollowLabel))},complete:function(){$(e).removeClass("disabled")}})},unfollow:function(e,a,t,o){if($(e).hasClass("disabled"))return!1;var i={followingId:a};$(e).addClass("disabled"),$.ajax({url:Label.servePath+"/follow/"+t,type:"DELETE",cache:!1,data:JSON.stringify(i),success:function(i,n){i.sc&&(void 0!==o?"article"===t||"tag"===t?$(e).removeClass("ft-red").html('<span class="icon-star"></span> '+(o-1)).attr("onclick","Util.follow(this, '"+a+"', '"+t+"',"+(o-1)+")").attr("aria-label",Label.collectLabel):"article-watch"===t&&$(e).removeClass("ft-red").html('<span class="icon-view"></span> '+(o-1)).attr("onclick","Util.follow(this, '"+a+"', '"+t+"',"+(o-1)+")").attr("aria-label",Label.followLabel):$(e).attr("onclick","Util.follow(this, '"+a+"', '"+t+"')").text("article"===t?Label.collectLabel:Label.followLabel))},complete:function(){$(e).removeClass("disabled")}})},goTop:function(){$("html, body").animate({scrollTop:0},800)},goLogin:function(){if(-1===location.href.indexOf("/login")){var e=location.href;0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/login?goto="+encodeURIComponent(e)}},needLogin:function(){Util.goLogin()},goRegister:function(){if(-1===location.href.indexOf("/register")){var e=location.href;0===location.search.indexOf("?goto")&&(e=location.href.replace(location.search,"")),window.location.href=Label.servePath+"/register?goto="+encodeURIComponent(e)}},_kill:function(){"IE"===$.ua.browser.name&&parseInt($.ua.browser.version)<10&&$.ajax({url:Label.servePath+"/kill-browser",type:"GET",cache:!1,success:function(e,a){$("body").append(e),$("#killBrowser").dialog({modal:!0,hideFooter:!0,height:345,width:600}),$("#killBrowser").dialog("open")}})},_initActivity:function(){var e=$(".person-info"),a=e.data("percent"),t=0,o=0,i=0;a<=25?t=parseInt(a/.25):a<=75?(t=100,o=parseInt((a-25)/2/.25)):a<=100&&(t=100,o=100,i=parseInt((a-75)/.25)),e.find(".bottom").css({width:t+"%",left:(100-t)/2+"%"}),e.find(".top-left").css({width:parseInt(i/2)+"%",left:0}),e.find(".top-right").css({width:parseInt(i/2)+"%",right:0}),e.find(".left").css({height:o+"%",top:100-o+"%"}),e.find(".right").css({height:o+"%",top:100-o+"%"})},init:function(e){if(this._kill(),this._initNav(),this._initActivity(),1===$(".pagination select").length&&$(".pagination select").change(function(){var e=$(this).data("url")+"?p="+$(this).val();$(this).data("param")&&(e+="&"+$(this).data("param")),window.location.href=e}),$(".nav input.search").focus(function(){$(".nav .tags").css("visibility","hidden")}).blur(function(){$(".nav .tags").css("visibility","visible")}),$(window).scroll(function(){$(window).scrollTop()>20&&0===$(".radio-btn").length?$(".go-top").show():$(".go-top").hide()}),e&&(window.localStorage.hadNotificate||(window.localStorage.hadNotificate="false"),Util.setUnreadNotificationCount()),this._initCommonHotKey(),console.log("%cCopyright © 2012-%s, b3log.org & hacpai.com\n\n%cHacPai%c 平等、自由、奔放\n\n%cFeel easy about trust.","font-size:12px;color:#999999;",(new Date).getFullYear(),'font-family: "Helvetica Neue", "Luxi Sans", "DejaVu Sans", Tahoma, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;font-size:64px;color:#404040;-webkit-text-fill-color:#404040;-webkit-text-stroke: 1px #777;','font-family: "Helvetica Neue", "Luxi Sans", "DejaVu Sans", Tahoma, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;font-size:12px;color:#999999; font-style:italic;','font-family: "Helvetica Neue", "Luxi Sans", "DejaVu Sans", Tahoma, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;font-size:12px;color:#999999;'),e)return!1;$("body").click(function(e){0===$(e.target).closest(".nav .form").length&&$(".nav .form").hide()})},initUserChannel:function(e){var a=new ReconnectingWebSocket(e);a.reconnectInterval=1e4,a.onopen=function(){setInterval(function(){a.send("-hb-")},3e5)},a.onmessage=function(e){switch(JSON.parse(e.data).command){case"refreshNotification":Util.setUnreadNotificationCount()}},a.onclose=function(){a.close()},a.onerror=function(e){console.log("ERROR",e)}},_initNav:function(){var e=location.href;$(".user-nav > a").each(function(){0===e.indexOf($(this).attr("href"))?$(this).addClass("current"):"/register"===location.pathname?$(".user-nav a:last").addClass("current"):"/login"===location.pathname?$(".user-nav a:first").addClass("current"):0!==e.indexOf(Label.servePath+"/settings")&&0!==e.indexOf($("#aPersonListPanel").data("url"))||$("#aPersonListPanel").addClass("current")}),$(".nav .avatar-small").parent().click(function(){$("#personListPanel").show()}),$("body").click(function(e){"aPersonListPanel"!==$(e.target).closest("a").attr("id")&&"personListPanel"!==$(e.target).closest(".module").attr("id")&&$("#personListPanel").hide()}),
1===$(".nav-tabs a:last").length&&$(".nav-tabs a:last")[0].offsetTop>0&&$(".nav-tabs").mouseover(function(){$(".user-nav").hide()}).mouseout(function(){$(".user-nav").show()})},logout:function(){window.localStorage&&(window.localStorage.clear(),window.localStorage.hadNotificate="false"),window.location.href=Label.servePath+"/logout?goto="+Label.servePath},startsWith:function(e,a){return e.match("^"+a)==a},uploadFile:function(e){var a="",t=0,o=[],i=!1;if(""===e.qiniuUploadToken)return $("#"+e.id).fileupload({multipart:!0,pasteZone:e.pasteZone,dropZone:e.pasteZone,url:Label.servePath+"/upload",paramName:"file",add:function(a,o){if(t++,window.File&&window.FileReader&&window.FileList&&window.Blob){var n=new FileReader;n.readAsArrayBuffer(o.files[0]),n.onload=function(a){var t=new Uint8Array(a.target.result.slice(0,11));return(i=isImage(t))&&a.target.result.byteLength>e.imgMaxSize?void alert("This image is too large (max "+e.imgMaxSize/1024/1024+"M)"):!i&&a.target.result.byteLength>e.fileMaxSize?void alert("This file is too large (max "+e.fileMaxSize/1024/1024+"M)"):void o.submit()}}else o.submit()},formData:function(e){return e.serializeArray()},submit:function(a,o){if(e.editor.replaceRange&&1===t){var i=e.editor.getCursor();e.editor.replaceRange(e.uploadingLabel,i,i)}else $("#"+e.id+" input").prop("disabled",!0)},done:function(o,n){var r=n.result.key;if(!r)return void alert("Upload error");if(e.editor.replaceRange){var l=e.editor.getCursor();a=n.result.name,i?e.editor.replaceRange("!["+a+"]("+r+") \n\n",CodeMirror.Pos(l.line,l.ch-e.uploadingLabel.length),l):e.editor.replaceRange("["+a+"]("+r+") \n\n",CodeMirror.Pos(l.line,l.ch-e.uploadingLabel.length),l)}else e.editor.$it.val(e.editor.$it.val()+"!["+a+"]("+r+") \n\n"),$("#"+e.id+" input").prop("disabled",!1);t--},fail:function(a,o){if(alert("Upload error: "+o.errorThrown),e.editor.replaceRange){var i=e.editor.getCursor();e.editor.replaceRange("",CodeMirror.Pos(i.line,i.ch-e.uploadingLabel.length),i)}else $("#"+e.id+" input").prop("disabled",!1);t--}}).on("fileuploadprocessalways",function(e,a){var t=a.files[a.index];a.files.error&&t.error&&alert(t.error)}),!1;$("#"+e.id).fileupload({multipart:!0,pasteZone:e.pasteZone,dropZone:e.pasteZone,url:"https://up.qbox.me/",paramName:"file",add:function(t,n){if(n.files[0].name){var r=n.files[0].name.match(/[a-zA-Z0-9.]/g).join("");a=getUUID()+"-"+r,""===r.split(".")[0]&&(a=getUUID()+r)}else a=getUUID()+"."+n.files[0].type.split("/")[1];if(o.push(a),window.File&&window.FileReader&&window.FileList&&window.Blob){var l=new FileReader;l.readAsArrayBuffer(n.files[0]),l.onload=function(a){var t=new Uint8Array(a.target.result.slice(0,11));return(i=isImage(t))&&a.target.result.byteLength>e.imgMaxSize?void alert("This image is too large (max "+e.imgMaxSize/1024/1024+"M)"):!i&&a.target.result.byteLength>e.fileMaxSize?void alert("This file is too large (max "+e.fileMaxSize/1024/1024+"M)"):void n.submit()}}else n.submit()},formData:function(a){var i=a.serializeArray(),n=o[t++];return i.push({name:"key",value:"file/"+(new Date).getFullYear()+"/"+((new Date).getMonth()+1)+"/"+n}),i.push({name:"token",value:e.qiniuUploadToken}),i},submit:function(a,o){if(e.editor.replaceRange&&1===t){var i=e.editor.getCursor();e.editor.replaceRange(e.uploadingLabel,i,i)}else $("#"+e.id+" input").prop("disabled",!1)},done:function(n,r){var l=r.result.key;if(!l)return void alert("Upload error");if(o.map(function(e,t,o){l.split("/")[3]===e&&(a=e,o.splice(t,1))}),e.editor.replaceRange){var s=e.editor.getCursor();i?e.editor.replaceRange("!["+a+"]("+e.qiniuDomain+"/"+l+") \n\n",CodeMirror.Pos(s.line,s.ch-e.uploadingLabel.length),s):e.editor.replaceRange("["+a+"]("+e.qiniuDomain+"/"+l+") \n\n",CodeMirror.Pos(s.line,s.ch-e.uploadingLabel.length),s)}else e.editor.$it.val("!["+a+"]("+e.qiniuDomain+"/"+l+") \n\n"),$("#"+e.id+" input").prop("disabled",!1);t--},fail:function(a,o){if(alert("Upload error: "+o.errorThrown),e.editor.replaceRange){var i=e.editor.getCursor();e.editor.replaceRange("",CodeMirror.Pos(i.line,i.ch-e.uploadingLabel.length),i)}else $("#"+e.id+" input").prop("disabled",!1);t--}}).on("fileuploadprocessalways",function(e,a){var t=a.files[a.index];a.files.error&&t.error&&alert(t.error)})},mouseClickEffects:function(){var e=0;jQuery(document).ready(function(a){a("html").click(function(t){var o,i=18;e++,10==e?o=a("<b></b>").text("OωO"):20===e?o=a("<b></b>").text("(๑•́ ∀ •̀๑)"):30===e?o=a("<b></b>").text("(๑•́ ₃ •̀๑)"):40===e?o=a("<b></b>").text("(๑•̀_•́๑)"):50===e?o=a("<b></b>").text("（￣へ￣）"):60===e?o=a("<b></b>").text("(╯°口°)╯(┴—┴"):70===e?o=a("<b></b>").text("૮( ᵒ̌皿ᵒ̌ )ა"):80===e?o=a("<b></b>").text("╮(｡>口<｡)╭"):90===e?o=a("<b></b>").text("( ง ᵒ̌皿ᵒ̌)ง⁼³₌₃"):e>=100&&e<=105?o=a("<b></b>").text("(ꐦ°᷄д°᷅)"):(o=a('<svg><use xlink:href="#heart"></use></svg>'),i=Math.round(14*Math.random()+6));var n=t.pageX,r=t.pageY;o.css({"z-index":9999,top:r-20,left:n,position:"absolute",color:"#E94F06","font-size":i,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),a("body").append(o),o.animate({top:r-180,opacity:0},1500,function(){o.remove()})})})}},Validate={goValidate:function(e){for(var a="<ul>",t=0;t<e.data.length;t++)Validate.validate(e.data[t])||(a+="<li>"+e.data[t].msg+"</li>");return"<ul>"===a?(e.target.html(""),e.target.removeClass("error"),!0):(e.target.html(a+"</ul>"),e.target.addClass("error"),!1)},validate:function(e){var a=!0,t="";switch(t="editor"===e.type?e.target.getValue():"imgSrc"===e.type?e.target.attr("src"):"imgStyle"===e.type?e.target.data("imageurl"):e.target.val().toString().replace(/(^\s*)|(\s*$)/g,""),e.type){case"email":/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e.target.val())||(a=!1);break;case"password":(0===e.target.val().length||e.target.val().length>16)&&(a=!1);break;case"confirmPassword":e.target.val()!==e.original.val()&&(a=!1);break;case"tags":var o=t.split(",");(""===t||o.length>7)&&(a=!1);for(var i=0;i<o.length;i++)if(""===o[i].replace(/(^\s*)|(\s*$)/g,"")||o[i].replace(/(^\s*)|(\s*$)/g,"").length>50){a=!1;break}break;case"url":case"imgSrc":case"imgStyle":(""===t||""!==t&&(!/^\w+:\/\//.test(t)||t.length>100))&&(a=!1);break;default:a=t.length<=e.max&&t.length>=(e.min?e.min:0)}return a}},Label={},pngMagic=[137,80,78,71,13,10,26,10],jpeg_jfif=[74,70,73,70],jpeg_exif=[69,120,105,102],jpegMagic=[255,216,255,224],gifMagic0=[71,73,70,56,55,97],getGifMagic1=[71,73,70,56,57,97],wavMagic1=[82,73,70,70],wavMagic2=[87,65,86,69],Audio={availabel:!1,wavFileBlob:null,recorderObj:null,init:function(e){function a(e){console.log("getUserMedia->failure(): ERROR: Microphone access request failed!");switch(e.name){case"PermissionDeniedError":Label.recordDeniedLabel;break;case"DevicesNotFoundError":Label.recordDeviceNotFoundLabel;break;default:"ERROR: The following unexpected error occurred while attempting to connect to your microphone: "+e.name}}function t(a){var t=PredefinedRecordingModes.MONO_5_KHZ,o=t.getSampleRate(),i=t.getChannelCount(),n=new BrowserWindowAudioContextDetection;if(!n.windowAudioContextSupported()){return void console.log("getUserMedia->success(): Unable to detect window audio context, cannot continue.")}var r=n.getWindowAudioContextMethod();Audio.recorderObj=new SoundRecorder(r,2048,o,i),Audio.recorderObj.init(a),Audio.recorderObj.recorder.onaudioprocess=function(e){if(Audio.recorderObj.isRecording()){var a=e.inputBuffer.getChannelData(0),t=e.inputBuffer.getChannelData(1);Audio.recorderObj.cloneChannelData(a,t)}},Audio.availabel=!0,e&&e()}var o=new BrowserGetUserMediaDetection;o.getUserMediaSupported()?(navigator.getUserMedia=o.getUserMediaMethod(),navigator.getUserMedia({audio:!0},t,a)):console.log("ERROR: getUserMedia not supported by browser.")},handleStartRecording:function(){Audio.recorderObj.startRecordingNewWavFile()},handleStopRecording:function(){Audio.recorderObj.stopRecording(),Audio.wavFileBlob=Audio.recorderObj.buildWavFileBlob()}};